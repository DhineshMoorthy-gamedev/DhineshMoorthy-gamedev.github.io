<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="blog-title">Loading...</title>

  <!-- Your CSS -->
  <link rel="stylesheet" href="mnist_styles.css">

  <!-- Syntax Highlighting -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>

  <header>
    <h1 id="post-title">Loading...</h1>
    <p class="meta" id="post-meta"></p>
    <div id="post-categories" class="categories"></div>
    <div class="demo-buttons">
      <a id="demo-link" href="#" class="demo-btn" target="_blank" style="display:none;">üîó WEBGL Demo</a>
      <a id="download" href="#" class="demo-btn" target="_blank" style="display:none;">‚¨áÔ∏è Download APK</a>
    </div>
    
    
    <img id="cover-image" src="" alt="" style="display:none;">
  </header>

  <main id="post-content">
    <!-- Blog content dynamically inserted here -->
  </main>

  <footer>¬© 2025 Dhinesh Moorthy</footer>

  <script>
    fetch('mnist.json')
      .then(res => res.json())
      .then(data => {
        // Header
        document.title = data.title;
        document.getElementById('post-title').textContent = data.title;
        document.getElementById('post-meta').textContent = `By ${data.author} ‚Äî ${data.date}`;

        // Categories
        const catContainer = document.getElementById('post-categories');
        data.categories.forEach(cat => {
          const span = document.createElement('span');
          span.classList.add('category');
          span.textContent = cat;
          catContainer.appendChild(span);
        });

        // Demo Link
        if (data.demoLink) {
          const demoBtn = document.getElementById('demo-link');
          demoBtn.href = data.demoLink;
          demoBtn.style.display = 'inline-block';
        }

        if (data.download) {
          const demoBtn = document.getElementById('download');
          demoBtn.href = data.download;
          demoBtn.style.display = 'inline-block';
        }

        // Cover Image
        if (data.coverImage) {
          const cover = document.getElementById('cover-image');
          cover.src = data.coverImage;
          cover.style.display = 'block';
        }

        // Sections
        const content = document.getElementById('post-content');
        data.sections.forEach(sec => {
          const section = document.createElement('section');
          section.innerHTML = `
            <h2>${sec.heading}</h2>
            <p>${sec.content}</p>
          `;

          if (sec.image) {
            const img = document.createElement('img');
            img.src = sec.image;
            img.classList.add('section-image');
            section.appendChild(img);
          }

          // if (sec.code) {
          //   const wrapper = document.createElement('div');
          //   wrapper.classList.add('code-wrapper');

          //   const pre = document.createElement('pre');
          //   const code = document.createElement('code');
          //   code.classList.add(sec.code.language);
          //   code.textContent = sec.code.snippet;
          //   pre.appendChild(code);

          //   // Copy Button
          //   const copyBtn = document.createElement('button');
          //   copyBtn.classList.add('copy-btn');
          //   copyBtn.textContent = "Copy";
          //   copyBtn.addEventListener('click', () => {
          //     navigator.clipboard.writeText(sec.code.snippet)
          //       .then(() => {
          //         copyBtn.textContent = "Copied!";
          //         setTimeout(() => copyBtn.textContent = "Copy", 1500);
          //       })
          //       .catch(err => console.error("Failed to copy: ", err));
          //   });

          //   wrapper.appendChild(copyBtn);
          //   wrapper.appendChild(pre);
          //   section.appendChild(wrapper);
          // }
          if (sec.code) {
    const wrapper = document.createElement('div');
    wrapper.classList.add('code-wrapper');

    // Pre element
    const pre = document.createElement('pre');
    const code = document.createElement('code');
    code.classList.add(sec.code.language);
    code.textContent = sec.code.snippet;
    pre.appendChild(code);
    pre.style.maxHeight = "120px"; // ~4-5 lines
    pre.style.overflow = "hidden";
    pre.style.position = "relative";
    pre.style.paddingLeft = "30px"; // space for arrow

    // Arrow inside the code block (left)
    const arrow = document.createElement('span');
    arrow.textContent = "‚ñ∂";
    arrow.style.position = "absolute";
    arrow.style.left = "8px";
    arrow.style.top = "8px";
    arrow.style.cursor = "pointer";
    arrow.style.transition = "transform 0.2s";

    // Copy button inside the code block (top-right)
    const copyBtn = document.createElement('button');
    copyBtn.classList.add('copy-btn');
    copyBtn.textContent = "Copy";
    copyBtn.style.position = "absolute";
    copyBtn.style.top = "8px";
    copyBtn.style.right = "8px";

    copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(sec.code.snippet)
            .then(() => {
                copyBtn.textContent = "Copied!";
                setTimeout(() => copyBtn.textContent = "Copy", 1500);
            })
            .catch(err => console.error("Failed to copy: ", err));
    });

    // Toggle logic
    arrow.addEventListener('click', () => {
        if (pre.style.maxHeight === "120px") {
            pre.style.maxHeight = "none";
            arrow.style.transform = "rotate(90deg)";
        } else {
            pre.style.maxHeight = "120px";
            arrow.style.transform = "rotate(0deg)";
        }
    });

    pre.appendChild(arrow);
    pre.appendChild(copyBtn);
    wrapper.appendChild(pre);
    section.appendChild(wrapper);
}



          if (sec.link) {
              const link = document.createElement('a'); // use <a>, not <href>
              link.href = sec.link;                     // set href attribute
              link.textContent = "Run WEBGL Demo";           // link text
              // link.target = "_blank";                   // open in new tab (optional)
              link.classList.add('section-link');       // optional CSS class
              section.appendChild(link);
          }


          content.appendChild(section);
        });

        // Highlight code
        hljs.highlightAll();
      })
      .catch(err => {
        document.getElementById('post-content').innerHTML = "<p>Error loading post.</p>";
        console.error(err);
      });
  </script>

</body>
</html>
